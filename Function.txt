use modelo_universidad;

drop function if exists fn_ver_creditos_cursados;

delimiter $$

create function fn_ver_creditos_cursados(p_documento_estudiante int)
returns int
deterministic
begin
    declare v_creditos int;
    
    select sum(materia.creditos) 
    into v_creditos
    from estudiante_x_curso 
    inner join curso on estudiante_x_curso.id_curso = curso.id_curso
    inner join materia on curso.id_materia = materia.id
    where estudiante_x_curso.documentos_estudiante = p_documento_estudiante;

    return v_creditos;
end $$

delimiter ; 

select documento,
	concat(nombre, ' ', apellido) as full_name,
        fn_ver_creditos_cursados(documento) as creditos_que_cursa
from estudiante;
